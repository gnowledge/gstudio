{% extends "ndf/node_details_base.html" %}
{% load ndf_tags %}
from django.contrib.auth.decorators import login_required
{% block title %} Group Dashboard {% endblock %}

{% block head %}


<script type="text/javascript" ></script>
 
<script>
var chk_login = "{{ user }}";
</script>
	


<script type="text/javascript">
//function to toggle the lable Join and Unsubscribe
function change_label(label)
{   
	if(chk_login=="AnonymousUser")
		{document.location.href = '/accounts/login/';
		}
	
     else if(label == "Join")
    { $("#notify").val("Unsubscribe");}
    else
    { $("#notify").val("Join");}
}

//function for sending notifications for Join and Unsubscribe
function notify(group,activity)
{

  var surl="/"+group+"/group/notify/"+activity+"/"
  $.ajax({
    url: surl,
    beforeSend: function() {
      $("#ajax_load_image").show();
      $("#body").css({"opacity":"0.1",})
    },
    success: function(data){
      $("#ajax_load_image").hide();
      $("#body").css({"opacity":"",})
    },
    complete: function(){
      $("#ajax_load_image").hide();
      $("#body").css({"opacity":"",})
    }
});  //end_ajax


}


$(document).ready(function()
{
  var groupn = $("#groupname").val();
  var label = $("#notify").val();
  $("#notify").click(function(){
   if (label == "Join")
    {
     notify(groupn,"join");
    change_label("Join");
    label="Unsubscribed"
    }
    else {
      notify(groupn,"remove");
      change_label("remove");
      label="Join"
	
    }
  }); //end notify_click()
}); //end document_ready()

</script>
{% endblock %}

{% block url %}
{% url 'edit_group' groupobj.name groupobj %}
{% endblock %}


{% block meta_content %}
<p> Members in this group :{{node.author_set|length}} </p>
{% get_group_name request.path as group %}
{% get_group_policy group request.user as policy %}
{% check_user_join request group as user_is_joined %}
<input type="hidden" id="groupname" value="{{group}}">
{% if user_is_joined == "joined" %}
     <input class="button tiny" type="submit" id="notify" value="Unsubscribe" class="button" align="center" style="visibility:visible" >
{% elif user_is_joined == "not" or not user.is_authenticated  %}

     <input class="button tiny" type="submit" id="notify" value="Join" class="button" align="center" style="visibility:visible" >
{% endif %}
{% get_user_object node.created_by as user_obj %}
{% ifequal  user_obj.username  user.username  %}
     <h3>Manage</h3>
     <p>You can invite other members to be a part of this group</p>
     {% include "ndf/invite_users.html" %}   
{% endifequal %} 
   
{% endblock %}

{% block body_content %}
<!-- Place for group splash page design
<a class="button" data-reveal-id="group-splash">Intro</a>
<div id="group-splash" class="reveal-modal" data-reveal>

<img src="http://farm3.staticflickr.com/2517/3677733159_2e2c7bec4b_b.jpg">
</div-->
{{ block.super }}
{% endblock %}

