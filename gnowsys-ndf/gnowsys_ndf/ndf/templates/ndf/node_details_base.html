{% extends "ndf/base.html" %}
{% load ndf_tags %}
{% block title %} {{ node.member_of_names_list|join:", " }} - {{ node.name }}  {% endblock %}
{% block head %}

<!-- MathJax-File-Based-Configuration: Loading MathJax with given file -->
<script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- MathJax-In-Line-Configuration: Specifying the configuration settings -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['\\[','\\]'], ['$$','$$']]
    }
  });
</script>

<!-- script to call ajax function for converting collection into module -->
<script>
  $(document).ready(function()
  {
    $("#module").one("click", function()
    {
     $.ajax({
      url:"/{{group_name}}/ajax/make_module",
      type:"GET",
      data:{_id:"{{node.pk}}"},
      beforeSend:function(){
        $("#ajax_search").show();
      },
      success: function(result){
       $("#ajax_search").hide();
       $("#module").attr("disabled", "disabled");
       alert(result);

     }
   });
   });
  });
</script>

{% endblock %}

{% block meta_content %}

<!--This content possibly comes from page_details.html-->

<p>
  {{ node.member_of_names_list|join:', ' }} posted on {{ node.created_at|date:"j F Y" }} by {{ node.user_details_dict.created_by }}
</p>
<p>
  Contributed by: {{ node.user_details_dict.modified_by|join:', ' }}
</p>
<p>

  Last update: {{ node.last_update|date:"j F Y" }}
</p>
<p>
  Version{{ node.version_dict|length|pluralize }}: 
  {% for seq_no, version_no in node.version_dict.items reversed %}
  <abbr title={{version_no}}><a href="{% url 'node_version' group_id node.pk version_no %}" style="padding-left:5px;">+</a></abbr> 
  {% endfor %}
</p>

{% endblock %}

{% block related_content %}

<ul class="side-nav">
  {% if node.collection_dict|length > 0 %}
  <h3>Contents</h3>
  {% for index_key, each_node in node.collection_dict.items %}
  {% get_grid_fs_object each_node as grid_fs_obj %}

  {% if each_node.mime_type %}

  {% if each_node.collection_set %}

  <li>

    <abbr title="Collection"><img src="/static/ndf/images/folder.png"></abbr>


    <a href="{% url 'read_file' group_name each_node.pk grid_fs_obj.filename %}" style="padding-left:10px;">{{ each_node.name }}</a>
  </li>

  {% else %}
  <li>
    <abbr title="Page"><img src="/static/ndf/images/doc.png"></abbr>

    <a href="{% url 'read_file' group_name each_node.pk grid_fs_obj.filename %}" style="padding-left:12px;">{{ each_node.name }}</a> 
  </li>
  {% endif %}

  {% else %}
  {% if each_node.collection_set %}
  <li>
    <abbr title="Collection"><img src="/static/ndf/images/folder.png"></abbr>
    <a href="{% url 'page_details' group_name each_node.pk %}" style="padding-left:10px;">{{ each_node.name }}</a>
  </li>

  {% else %}
  <li>
    <abbr title="Page"><img src="/static/ndf/images/doc.png"></abbr>
    <a href="{% url 'page_details' group_name each_node.pk %}" style="padding-left:12px;">{{ each_node.name }}</a>
  </li>
  {% endif %}
  {% endif %}
  {% endfor %}

  {% endif %}
</ul>


{% endblock %}


{% block shelf_content %}
<h4 class="text-center">Shelf</h4>
<dl id="shelf-items" class="accordion" data-accordion>
  <!-- Adding new shelf text input and add button -->
  <dd>  
    <div class="row">
      <div class="row collapse">
        <div class="small-10 columns">
          <input type="text" id="new-shelf-text" onkeyup="(this.value).trim().length?$('#add-shelf-btn').removeClass('disabled'):$('#add-shelf-btn').addClass('disabled');" placeholder="Add new shelf">
        </div>
        <div class="small-2 columns">
          <div onclick="$(this).hasClass('disabled')?'':addNewShelf($('#new-shelf-text').val().trim())" id="add-shelf-btn" class="button postfix disabled">Add</div>
        </div>
      </div>
    </div>
  </dd>

</dl>

{% endblock %}


{% get_group_type request.path request.user as group_type %}

{% block body_content %}
<a id="toggle-shelf" class="right-off-canvas-toggle right" ><i class='fi-book-bookmark'></i></a> 

<header class="row page">


  <section class="medium-12 columns" >
    <ul class="breadcrumbs">
      <li><a href="/{{group_name}}">{{group_name}}</a></li>
      <li><a href="#">Collection Name</a></li>
    </ul>

    <h2>
      <span class='node'>{{node.name}}</span>      <small class="label-list"> 
      {% for tag in node.tags %}
      <span class="radius label">{{tag}}</span> 
      {% endfor %}
    </small>      
  </h2>

  <dl class="row tabs" data-tab>
    <dd class="active"><a href="#view-page"><i class="fi-eye"></i> Read</a></dd>

    {% if '/details/' in request.path  or '/image_detail/' in request.path  or '/video_detail/' in request.path%}

    <dd><a href="#" data-reveal-id="view-graph"><i class="fi-share"></i> Graph</a></dd>

    {% endif %}

    <dd><a href="#view-comments"><i class="fi-comment"></i> Discuss</a></dd>

  </section>

</header>

<div class="row">



  <section class="medium-9 columns">
    <div class="tabs-content">

      <!-- Tab content -->
      <div class="content active" id="view-page">

       {% if node.prior_node|length > 0 %}
       <div class="panel">
         <h6>You may want to read these first:</h6>
          {% for index_key, each_node in node.prior_node_dict.items %}
          {% get_grid_fs_object each_node as grid_fs_obj %}
          {% if each_node.mime_type %}
          <a href="{% url 'read_file' group_id each_node.pk  grid_fs_obj.filename %}">{{ each_node.name }}</a>,&nbsp;
          {% else %}
          <a href="{% url 'page_details' group_id each_node.pk %}">{{ each_node.name }}</a>,&nbsp;
          {% endif %}
          {% endfor %}
        </div>
        {% endif %}

        {% block add_fields %} {% endblock %}

        <ul class="inline-list">
         {% if user.is_authenticated %}
         {% block add_list %}{% endblock %}
         {% endif %}
       </ul>

       {% with node.html_content|safe as description %}

       {% if description != "None" %}
       {{ description }}
       {% endif %}

       {% endwith %}
     </div>


     <!-- Tab View Graph -->
     <div class="content reveal-modal x-large graph-height" id="view-graph" data-reveal>    
      <h3>{{node.name}}</h3>
      {% if '/details/' in request.path  or '/image_detail/' in request.path  or '/video_detail/' in request.path%}
      <a class="close-reveal-modal">&#215;</a>
      {% include "ndf/node_graph.html" %}
      {% endif %}
    </div>

  </section>

  <section class="medium-3 columns">
    <div class="panel">
     <h5 class="subheader">
       Edited {{ node.last_update|timesince }} ago by <a class="user">?</a> 
       <small>
         <div><a href="#view-changes"><i class="fi-clock"></i> View changes </a>
          {% for seq_no, version_no in node.version_dict.items reversed %}
          <abbr title={{version_no}}><a href="{% url 'node_version' group_name node.pk version_no %}" style="padding-left:5px;">+</a></abbr> 
          {% endfor %}
        </div>
      </small>
    </h5>


    <!-- added button to convert collection into module-->
    {% if node.collection_set and user.is_authenticated%}
    <a href="#" class="button" id="module"></i> <span>Make Module</a>
    {% endif %}


    <a href="{% block url %}{% endblock %}" class="small button split edit"><i class="fi-pencil"></i> Edit now <span data-dropdown="edit-options"></span></a>
    <ul id="edit-options" class="f-dropdown">
      <li><a href="{% url 'page_create_edit' newgroup %}">Create a new page</a></li>
    </ul>

  </div>



</section>


</div>

<footer>
  <p><small>
    <em>Written by {{ node.user_details_dict.modified_by|join:', ' }}</em></small></p>
  </footer>

  {% endblock %}


  {% block script%}

  function addNewShelf(shelfName)
  {
  shelfNameList = [];
  $('#shelf-items dd > a').each(function(b){ shelfNameList.push($(this).text())});
  
  if ( ($.inArray(shelfName.toLowerCase(), $.map(shelfNameList, function(n,i){return n.toLowerCase()}))) < 0 )
  {
  shelfNameId = shelfName.split(" ").join("_");

  $( "#shelf-items dd:nth-child(1)" )
  .after( "<dd><a href='#panel_"+shelfNameId+"'>"+shelfName+"</a><div id='panel_"+shelfNameId+"' class='content'><a href='#' class='button expand'> Add this to shelf </a></div></dd>" );
}
else
{
  alert("Shelf with this name already exist !\n\n Create shelf with different name.");
}

}

{% endblock %}
