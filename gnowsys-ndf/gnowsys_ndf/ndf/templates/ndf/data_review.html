{% extends "ndf/base.html" %}
{% load i18n %}
{% load ndf_tags %}
{% load pagination_tags %}
{% get_group_name groupid as group_name_tag %}

{% block style %}

	.right-border{
		border-right: 1px solid #dddddd
	}

	.bottom-border > th {
		border-bottom: 1px solid #f1f1f1;
	}

	article.columns{
		padding-bottom: 0;
		margin-bottom: 2em;
	}

	.expand-width-8{
		padding: 0 8em;
	}

	.expand-width-6{
		padding: 0 6em;
	}

	.expand-width-3{
		padding: 0 3em;
	}

	.expand-width-2{
		padding: 0 2em;
	}

	.expand-width-1{
		padding: 0 1em;
	}

	.hide-el input, .hide-el select{
		display: none;
	}

	.show-el input, .show-el select{
		display: block;
	}

	.show-view-border{
		border: solid #43ac6a;
		border-bottom: none;
	}
	
	.show-edit-border{
		border: solid #43ac6a;
		border-top: none;
	}

	/* drawer CSS */
	.resource-drawer { 
		border-color: #D3D3D3; border-style: solid; 
		padding: 0 !important; 
		overflow-y: auto;
	}

	.resource-drawer li.bullet-item:hover{
		background-color: #ecf0f1; cursor:pointer;
	}

	.posted-by{ color: #808080; font-size: small; }

	.selected-resource { background-color:lightgray !important ; }

	.resource-type-image {
		height:40px; 		
		background-repeat:no-repeat; background-size: 48px 48px
	}
	/* ---END of drawer CSS */



{% endblock %}

{% block body_content %}

<br/>
<input type="hidden" id="currently-edited-row" data-edited-row-id="" data-edited-row-name="">

<table style="width:auto">
<!-- <table> -->
	<thead>
		<tr>
			<th class="text-center right-border" colspan="5">Autogenerated</th>
			<th class="text-center right-border" colspan="5">Base</th>
			<th class="text-center right-border" colspan="7">Attribution</th>
			<th class="text-center right-border" colspan="2">LRMI</th>
			<th class="text-center right-border" colspan="3">Alignment & Level</th>
			<th class="text-center right-border" colspan="7">Curate</th>
			<th class="text-center right-border" colspan="3">Advance</th>
		</tr>
		<tr class="bottom-border">

			<!-- Autogenerated -->
			<th>Id</th>
			<th class="expand-width-3">Creation date</th>
			<th>Modified by</th>
			<th>Author</th>
			<th class="right-border">Contributors</th>

			<!-- Base -->
			<th class="expand-width-6">Name</th>
			<th class="expand-width-3">Altname</th>
			<th class="expand-width-6">content_org</th>
			<th class="expand-width-2">Language</th>
			<th class="expand-width-6 right-border">tags</th>

			<!-- Attribution -->
			<th class="expand-width-3">Created by</th>
			<th class="expand-width-3">Contributed by</th>
			<th class="expand-width-3">License</th>
			<th class="expand-width-3">Source</th>
			<th>Basenodeurl</th>
			<th>Translation of</th>
			<th class="right-border">Adaption of</th>

			<!-- LRMI -->
			<th class="expand-width-3">Educational use</th>
			<th class="right-border expand-width-2">Interactivity Type</th>

			<!-- Alignment and Level -->
			<th class="expand-width-1">Alignment</th>
			<th class="expand-width-8">Educational Level</th>
			<th class="right-border expand-width-3">Educational Subject</th>

			<!-- Curate -->
			<th class="expand-width-1">Curricular</th>
			<th class="expand-width-8">Audience</th>
			<th class="expand-width-2">Teaches</th>
			<th class="expand-width-2">Requires</th>
			<th class="expand-width-2">Featured</th>
			<th class="expand-width-3">Status</th>
			<th class="expand-width-3 right-border">Acess Policy</th>

			<!-- Advance -->
			<th class="expand-width-3">Reading Level</th>
			<th>Time Required</th>
			<th class="expand-width-3">Text Complexity</th>

		</tr>

	</thead>
	<tbody>
		<!-- Looping through each resource -->
		{% for resource in files %}
		<tr id="view-row-{{resource.pk}}">

			<!-- Autogenerated -->
			<td class="view">{{ resource.pk }}</td>
			<td class="view">{{ resource.created_at }}</td>
			<td class="view">{{ resource.user_details_dict.modified_by }}</td>
			<td class="view">{{ resource.user_details_dict.created_by }}</td>
			<td class="view right-border">{{ resource.user_details_dict.contributors | join:", " }}</td>
			
			<!-- Base -->
			<td class="view">{{ resource.name }}</td>
			<td class="view">{{ resource.altnames }}</td>
			<td class="view" title="{{ resource.content_org }}">{{ resource.content_org | truncatechars:60 }}</td>
			<td class="view">{{ resource.language }}</td>
			<td class="view right-border"> {{resource.tags|safeseq|join:", "}} </td>

			<!-- Attribution -->
			<td class="view">{{ resource.creator }}</td>
			<td class="view">{{ resource.other_contributors }}</td>
			<td class="view">{{ resource.license }}</td>
			<td class="view">{{ resource.source }}</td>
			<td class="view">{{ resource.basedonurl }}</td>
			<td class="view">{{ resource.translation_of }}</td>
			<td class="view right-border">{{ resource.adaptation_of }}</td>

			<!-- LRMI -->
			<td class="view">{{ resource.educationaluse }}</td>
			<td class="view right-border">{{ resource.interactivitytype }}</td>

			<!-- Alignment and Level -->
			<td class="view">{{ resource.educationalalignment }}</td>
			<td class="view">{{ resource.educationallevel }}</td>
			<td class="view right-border">{{ resource.educationalsubject }}</td>

			<!-- Curate -->
			<td class="view">{{ resource.curricular }}</td>
			<td class="view">{{ resource.audience }}</td>
			<td class="view">
				{% for each_teaches in resource.teaches %}
					{{ each_teaches.name }}{% if not forloop.last %}, {% endif %}
				{% endfor %}
			</td>
			<td class="view"><!-- prior_node processing -->
				{% for index_key, each_node in resource.prior_node_dict.items %}
					{{ each_node.name }}{% if not forloop.last %}, {% endif %}
				{% endfor %}
			</td>
			<td class="view">{{ resource.featured }}</td>
			<td class="view">{{ resource.status }}</td>
			<td class="view right-border">{{ resource.access_policy }}</td>

			<!-- Advance -->
			<td class="view">{{ resource.readinglevel }}</td>
			<td class="view">{{ resource.timerequired }}</td>
			<td class="right-border">{{ resource.textcomplexity }}</td>
			
		</tr>
		<tr></tr>
		
		<tr id="edit-row-{{resource.pk}}" data-row-name="{{resource.name}}">
			
			<!-- Autogenerated -->
			<td class="right-border" colspan="5">
				<div class="button tiny expand" data-id="edit-btn-{{resource.pk}}" onclick="editResRow('{{resource.pk}}')">
					Edit
				</div>
				<div class="row" style="display:none;" data-id="save-cancel-div-{{resource.pk}}">
					<span class="small-push-1 small-4 columns button success tiny" onclick="saveResource('{{resource.pk}}')" data-id="save-btn-{{resource.pk}}">
						Save
					</span>
					<span class="small-pull-1 small-4 columns button alert tiny" data-id="cancel-btn-{{resource.pk}}" onclick="CancelEditResRow('{{resource.pk}}')">
						Cancel
					</span>
				</div>
			</td>

			<!-- Base -->
			<td class="hide-el" data-field="name"><input type="text" value="{{ resource.name }}" /></td>
			<td class="hide-el" data-field="altnames"><input type="text" value="{{ resource.altnames }}" /></td>
			<td class="hide-el" data-field="content_org">
				<input type="button" data-reveal-id="content_org_overlay" class="button tiny expand" value="Edit content in editor" data-content-org="{{ resource.content_org }}" data-content-org-row-id="{{resource.pk}}" />
			</td>
			<td class="hide-el" data-field="language">
				<select name="language">
					{% for each_lang in static_language %}
						<option {%if each_lang|lower == resource.language|lower %}selected="selected"{%endif%} value="{{ each_lang }}">{{ each_lang }}</option>
					{% endfor %}
					<option {%if not resource.language %}selected="selected"{%endif%} value="None">
						None
					</option>
					
					{% comment %}
					<!-- <option {%if resource.language|lower == "english" %}selected="selected"{%endif%} value="English">English</option>
					<option {%if resource.language|lower == "hindi" %}selected="selected"{%endif%} value="Hindi">Hindi</option> -->
					<!-- {% for lang_code, lang_info in static_language.items %}
						<option {%if lang_info.name == resource.language %}selected="selected"{%endif%} value="{{ lang_info.name }}">{{ lang_info.name }}</option>
					{% endfor %} -->
					{% endcomment %}
				</select>
			</td>
			<td class="hide-el right-border" data-field="tags"><input type="text" value='{{resource.tags|safeseq|join:", "}}' />
			</td>

			<!-- Attribution -->
			<td class="hide-el" data-field="creator"><input type="text" value="{{ resource.creator }}" /></td>
			<td class="hide-el" data-field="other_contributors"><input type="text" value="{{ resource.other_contributors }}" /></td>
			<td class="hide-el" data-field="license"><input type="text" value="{{ resource.license }}" /></td>
			<td class="hide-el" data-field="source"><input type="text" value="{{ resource.source }}" /></td>
			<td class="hide-el" data-field="basedonurl"><input type="text" value="{{ resource.basedonurl }}" /></td>
			<td class="hide-el" data-field="translation_of">
				<!-- <input type="button" fill-data-reveal-id="" class="button tiny expand" value="Testing"/> -->
			</td>
			<td class="hide-el right-border" data-field="adaptation_of" >
				<input type="text" value="{{ resource.adaptation_of }}" />
			</td>

			<!-- LRMI -->
			<!-- <td class="view">{{ resource.educationaluse }}</td> -->
			<!-- <td class="view right-border">{{ resource.interactivitytype }}</td> -->

			<!-- LRMI -->
			<td class="hide-el" data-field="educationaluse">
				<select name="educationaluse">
					{% for each_edu_use in static_educationaluse %}
						<option {%if each_edu_use == resource.educationaluse %}selected="selected"{%endif%} value="{{ each_edu_use }}">
							{{ each_edu_use }}
						</option>
					{% endfor %}
					<option {%if not resource.educationaluse %}selected="selected"{%endif%} value="None">
						None
					</option>
				</select>
			</td>
			<td class="hide-el right-border" data-field="interactivitytype">
				<select name="interactivitytype">
					{% for each_intertype in static_interactivitytype %}
						<option {%if each_intertype == resource.interactivitytype %}selected="selected"{%endif%} value="{{ each_intertype }}">{{ each_intertype }}</option>
					{% endfor %}
					<option {%if not resource.interactivitytype %}selected="selected"{%endif%} value="None">
						None
					</option>
				</select>
			</td>

			<!-- Alignment and Level -->
			<td class="hide-el" data-field="educationalalignment">
				<select name="educationalalignment">
					{% for each_edu_align in static_educationalalignment %}
						<option {%if each_edu_align == resource.educationalalignment %}selected="selected"{%endif%} value="{{ each_edu_align }}">{{ each_edu_align }}</option>
					{% endfor %}
					<option {%if not resource.educationalalignment %}selected="selected"{%endif%} value=""></option>
				</select>
			</td>
			<td class="hide-el" data-field="educationallevel">
				<select name="educationallevel">
					{% for each_edulevel in static_educationallevel %}
						<option {%if each_edulevel == resource.educationallevel %}selected="selected"{%endif%} value="{{ each_edulevel }}">{{ each_edulevel }}</option>
					{% endfor %}
					<option {%if not resource.educationallevel %}selected="selected"{%endif%} value="None">
						None
					</option>
				</select>
			</td>
			<td class="hide-el right-border" data-field="educationalsubject">
				<select name="educationalsubject">
					{% for each_sub in static_educationalsubject %}
						<option {%if each_sub == resource.educationalsubject %}selected="selected"{%endif%} value="{{each_sub}}">{{ each_sub }}</option>
					{% endfor %}
					<option {%if not resource.educationalsubject %}selected="selected"{%endif%} value="None">
						None
					</option>
				</select>
			</td>

			<!-- Curate -->
			<td class="hide-el" data-field="curricular">
				<select name="curricular">
				{% for each_curr in static_curricular %}		
					<option {%if each_curr == resource.curricular %}selected="selected"{%endif%} value="{{ each_curr }}">{{ each_curr }}</option>
				{% endfor %}
					<option {%if not resource.curricular %}selected="selected"{%endif%} value=""></option>
				</select>
			</td>
			<td class="hide-el" data-field="audience">
				<select name="audience">
				{% for each_aud in static_audience %}		
					<option {%if each_aud == resource.audience %}selected="selected"{%endif%} value="{{ each_aud }}">{{ each_aud }}</option>
				{% endfor %}
					<option {%if not resource.audience %}selected="selected"{%endif%} value="None">
						None
					</option>
				</select>
			</td>
			<td class="hide-el" data-field="teaches">
				<input type="button" data-reveal-id="teaches-overlay" class="button tiny expand" value="Edit in drawer"/>
			</td>
			<td class="hide-el" data-field="prior_node">
				<input type="button" data-reveal-id="prior_node-overlay" class="button tiny expand" value="Edit in drawer"/>
			</td>
			<td class="hide-el" data-field="featured">
				<select name="featured">
					<option {%if resource.featured == "False"%}selected="selected"{%endif%} value="False">False</option>
					<option {%if resource.featured == "True"%}selected="selected"{%endif%} value="True">True</option>
					<option {%if not resource.featured %}selected="selected"{%endif%} value="None">
						None
					</option>
				</select>
			</td>
			<td class="hide-el" data-field="status">
				<select name="status">
				{% for each_status in static_status %}		
					<option {%if each_status == resource.status %}selected="selected"{%endif%} value="{{ each_status }}">{{ each_status }}</option>
				{% endfor %}	
				</select>
			</td>
			<td class="hide-el right-border" data-field="access_policy">
				<select name="access_policy">
					<option {%if resource.access_policy == "PUBLIC"%}selected="selected"{%endif%} value="PUBLIC">PUBLIC</option>
					<option {%if resource.access_policy == "PRIVATE"%}selected="selected"{%endif%} value="PRIVATE">PRIVATE</option>
					<option {%if not resource.access_policy %}selected="selected"{%endif%} value="None">
						None
					</option>
				</select>
			</td>

			<!-- Advance -->
			<td class="hide-el" data-field="readinglevel"></td>
			<td class="hide-el" data-field="timerequired">
				<input type="text" class="time-required" value="{{resource.timerequired}}"/>
			</td>
			<td class="hide-el" data-field="textcomplexity" class="right-border">
				<select name="textcomplexity">
				{% for each_tc in static_textcomplexity %}		
					<option {%if each_tc == resource.textcomplexity %}selected="selected"{%endif%} value="{{ each_tc }}">{{ each_tc }}</option>
				{% endfor %}	
					<option {%if not resource.textcomplexity %}selected="selected"{%endif%} value="None">
						None
					</option>
				</select>				
			</td>
		</tr>

		{% endfor %}
	</tbody>
</table>

<div id="content_org_overlay" class="reveal-modal" data-reveal>
  {% include "ndf/add_editor.html" with var_name="data_reveal_editor" var_placeholder="Enter your content here."  %}
  <a class="close-reveal-modal">&#215;</a>
</div>

<div id="teaches-overlay" data-right-drawer-list="" class="reveal-modal" data-reveal>
	teaches
	<div id="teaches_drawer"></div>
	<a class="close-reveal-modal">&#215;</a>
</div>

<div id="prior_node-overlay" data-right-drawer-list="" class="reveal-modal" data-reveal>
	prior node
	<div id="prior_node_drawer"></div>
	<a class="close-reveal-modal">&#215;</a>
</div>
<!-- END of Looping through each resource -->

{% endblock %}

<!-- Pagination -->
{% block data_review_pagination %}

	{% include 'ndf/pagination.html' with urlname="data_review_page" first_arg=group_name_tag second_arg="" third_arg="" %}

	<!-- Datetimepicker  -->
	<script src="/static/ndf/bower_components/jquery-ui/jquery-ui.js"></script> <!-- checked -->
	<script src="/static/ndf/bower_components/jqueryui-timepicker-addon/dist/jquery-ui-timepicker-addon.min.js"></script> <!-- checked -->
	<script src="/static/ndf/bower_components/jqueryui-timepicker-addon/dist/jquery-ui-sliderAccess.js"></script> <!-- checked -->
	<link rel="stylesheet" href="/static/ndf/bower_components/jqueryui-timepicker-addon/dist/jquery-ui-timepicker-addon.css"> <!-- checked -->
	<link rel="stylesheet" type="text/css" href="/static/ndf/bower_components/jquery-ui/themes/smoothness/jquery-ui.css"> <!-- checked -->

{% endblock %}
<!-- -END of Pagination -->


{% block script %}
// <script type="text/javascript">
	
	var isFieldEdited = false;

	// removing left panel:
	$("main.row > aside.columns").detach();

	// making body_content block to take 12-large columns
	$article = $("main.row > article.columns");
	$article.removeClass("medium-10").addClass("large-12");
	$article.css("overflow-x", "scroll");


	function checkCurrEditRow()
	{
		var editedRowName = document.getElementById("currently-edited-row").getAttribute("data-edited-row-name").trim(),
			editedRowId = document.getElementById("currently-edited-row").getAttribute("data-edited-row-id").trim();

		if(editedRowName.length > 0 || editedRowId.length > 0)
		{
			alert("At a time you could edit only one row. \n\nNow you are editing: '" + editedRowName + "'\n\nPlease 'SAVE' or 'CANCEL' the changes to edit any other row!");

			return true; // Row editing is going on.
		}
		else
		{
			return false; // NO row is being editing now.
		}
	}


	function setCurrEditRowToNone()
	{
		document.getElementById("currently-edited-row").setAttribute("data-edited-row-id", "");
		document.getElementById("currently-edited-row").setAttribute("data-edited-row-name", "");
	}

	// hiding save/cancel buttons and showing edit button again
	function changeSaveCancelToEdit(oid, resEditRowArr)
	{
		$("div[data-id='save-cancel-div-" + oid +"']").fadeOut(0);
		for (var i = 1; i < resEditRowArr.length; i++)
		{
			resEditRowArr[i].classList.add("hide-el");
		}

		$("tr#view-row-" + oid).removeClass("show-view-border");
		$("tr#view-row-" + oid).css("opacity", 1);

		$("tr#edit-row-" + oid).removeClass("show-edit-border");

		$("div[data-id='edit-btn-" + oid +"']").fadeIn(800);
		setCurrEditRowToNone();
	}

	// action on edit click:
	function editResRow(oid)
	{

		// exit from the function if any other row is being edited now.
		if(checkCurrEditRow()){ return false; }

		// fetching resource object edit row
		var $resEditRow = $("tr#edit-row-" + oid),
			resEditRowArr = $resEditRow.children();

		document.getElementById("currently-edited-row").setAttribute("data-edited-row-id", oid);
		document.getElementById("currently-edited-row").setAttribute("data-edited-row-name", $resEditRow.attr("data-row-name"));

		$("div[data-id='edit-btn-" + oid +"']").fadeOut(0);

		// processing each element of row
		for (var i = 0; i < resEditRowArr.length; i++)
		{
			resEditRowArr[i].classList.remove("hide-el");
		};

		// setting orgitdown_data_reveal_editor content to content_org of current row object.
		content_org = $("input[data-content-org-row-id="+oid+"]").attr("data-content-org");
		document.getElementById("orgitdown_data_reveal_editor").value = content_org;

		$resEditRow.addClass("show-edit-border");
		$("tr#view-row-" + oid).addClass("show-view-border");
		$("tr#view-row-" + oid).css("opacity", 0.25);

		$("div[data-id='save-cancel-div-" + oid +"']").fadeIn(800);

		populateTeachesPriorNode(oid, "teaches");
		populateTeachesPriorNode(oid, "prior_node");

	}


	function getEditSummary(oid, msg, action)
	{

		// fetching resource object VIEW row
		var $resViewRow = $("tr#view-row-" + oid),
			resViewRowArr = $resViewRow.children();

		// fetching resource object EDIT row
		var $resEditRow = $("tr#edit-row-" + oid);
			resEditRowArr = $resEditRow.children();

		// to show details on confirm popup
		var tempEditedFields = "";

		nodeObj = new Object()

		// processing each element of row
		for (var i = 1; i < resEditRowArr.length; i++)
		{
			// checking if the values in textboxes are changed
			if(resEditRowArr[i].firstElementChild)
			{
				if((resEditRowArr[i].firstElementChild.type == "text") || (resEditRowArr[i].firstElementChild.type == "select-one"))
				{
					var tempEditFieldVal = resEditRowArr[i].firstElementChild.value.trim(),
						tempViewFieldVal = resViewRowArr[4+i].textContent.trim();

					if(tempViewFieldVal != tempEditFieldVal)
					{
						tempEditedFields += "\n-------| FIELD: " + $(resEditRowArr[i]).attr("data-field") + " |-------\n\n(" 
						+ tempViewFieldVal + ")\nChanged to:\n(" 
						+ tempEditFieldVal + ")\n\n";
					}

					// adding the key value pair in nodeObj
					nodeObj[resEditRowArr[i].attributes.getNamedItem("data-field").value] = tempEditFieldVal;
				}
				else if((resEditRowArr[i].firstElementChild.type == "button"))
				{
					// 'content-org' field
					if(resEditRowArr[i].getAttribute("data-field") == "content_org")
					{
						var tempContentOrg = document.getElementById("orgitdown_data_reveal_editor").value.trim();

						if(resViewRowArr[4+i].getAttribute("title").trim() != tempContentOrg)
						{
							tempEditedFields += "\n-------| FIELD: " + $(resEditRowArr[i]).attr("data-field") + " |-------\n\n content_org's content is changed.\n\n"
						}

						nodeObj[resEditRowArr[i].attributes.getNamedItem("data-field").value] = tempContentOrg;
					}
					// 'prior_node' field and 'teaches' relation edit checking
					else if((resEditRowArr[i].getAttribute("data-field") == "teaches") || (resEditRowArr[i].getAttribute("data-field") == "prior_node"))
					{
						// calling following to fill values in hidden _list/s
						getDrawerVals();

						var tempPrevDrawerFields = $("#"+ resEditRowArr[i].getAttribute("data-field") +"-overlay").attr("data-right-drawer-list");
						var tempCurrDrawerFields = $("#" + resEditRowArr[i].getAttribute("data-field") + "_list").val();

						if(tempPrevDrawerFields != tempCurrDrawerFields)
						{
							// console.log(resEditRowArr[i].getAttribute("data-field") + tempPrevDrawerFields);
							// console.log(resEditRowArr[i].getAttribute("data-field") + tempCurrDrawerFields);
							tempEditedFields += "\n-------| FIELD: " + $(resEditRowArr[i]).attr("data-field") + " |-------\n\n Element's in right drawer are changed.\n\n"
						}

						nodeObj[resEditRowArr[i].attributes.getNamedItem("data-field").value] = tempCurrDrawerFields;
					}
				}

			}
		};

		isFieldEdited = (tempEditedFields.length > 0) ? true: false;

		if(isFieldEdited)
		{
			var saveCancelConfirm = "false"
			
			saveCancelConfirm = window.confirm("Please Note that following fields are changed:\n\n" + tempEditedFields + msg);
			
			if(saveCancelConfirm)
			{
				if(action == "save")
				{
					return [true, nodeObj];
				}
				changeSaveCancelToEdit(oid, resEditRowArr);
			}	
		}
		else
		{
			if(action == "save")
			{
				alert("No field is edited or changed to save !")
				return [false, nodeObj];
			}

			changeSaveCancelToEdit(oid, resEditRowArr)
		}

	}


	// function for setting the values in the view of data row.
	function setViewByEditData(oid)
	{
		// fetching resource object VIEW row
		var $resViewRow = $("tr#view-row-" + oid),
			resViewRowArr = $resViewRow.children();

		// fetching resource object EDIT row
		var $resEditRow = $("tr#edit-row-" + oid);
			resEditRowArr = $resEditRow.children();

		// processing each element of row
		for (var i = 1; i < resEditRowArr.length; i++)
		{
			// checking if the values in textboxes are changed
			if(resEditRowArr[i].firstElementChild)
			{
				if((resEditRowArr[i].firstElementChild.type == "text") || (resEditRowArr[i].firstElementChild.type == "select-one"))
				{
					var tempEditFieldVal = resEditRowArr[i].firstElementChild.value.trim(),
						tempViewFieldVal = resViewRowArr[4+i].textContent.trim();

					if(tempViewFieldVal != tempEditFieldVal)
					{
						resViewRowArr[4+i].textContent = resEditRowArr[i].firstElementChild.value.trim();						
					}
				}
				else if((resEditRowArr[i].firstElementChild.type == "button"))
				{
					var tempEditField = resEditRowArr[i].getAttribute("data-field");

					// 'content-org' field
					if(tempEditField == "content_org")
					{
						var tempContentOrg = document.getElementById("orgitdown_data_reveal_editor").value.trim();

						if(resViewRowArr[4+i].getAttribute("title").trim() != tempContentOrg)
						{
							resViewRowArr[4+i].title = tempContentOrg;
							resViewRowArr[4+i].textContent = tempContentOrg.substr(0, 60);
							resEditRowArr[i].firstElementChild.setAttribute("data-content-org", tempContentOrg);
						}

					}
					// 'prior_node' field and 'teaches' relation edit checking
					else if((tempEditField == "teaches") || (tempEditField == "prior_node"))
					{
						var tempPrevDrawerFields = $("#"+ tempEditField +"-overlay").attr("data-right-drawer-list");
						var tempCurrDrawerFields = $("#" + tempEditField + "_list").val();

						if(tempPrevDrawerFields != tempCurrDrawerFields)
						{
							var tempArr = [];
							$("#"+ tempEditField +"_drawer2").find(".node_id").each(function(){tempArr.push(this.getAttribute("name"))});

							resViewRowArr[4+i].textContent = tempArr.toString()	;
						}
					}
				}

			}
		}
	}



	function saveResource(oid)
	{
		// fetching resource object EDIT row
		var $resEditRow = $("tr#edit-row-" + oid);
			resEditRowArr = $resEditRow.children();

		var msg = "To save above changes click on - 'OK'."

		// to show details on confirm popup; getEditSummary returns: [bool, nodeObject]
		var nodeData = getEditSummary(oid, msg, "save");

		if(nodeData[0])
		{
			// console.log(JSON.stringify(nodeData[1]))
			$.ajax({

				type: "POST",
				url: "{% url 'data_review_save' groupid %}",
				data:{
					node_oid: oid,
					node_details: JSON.stringify(nodeData[1]),
					csrfmiddlewaretoken: '{{ csrf_token }}'
				},
				success: function(data){
					alert("Resource is successfully saved." + data);
					setViewByEditData(oid);
					changeSaveCancelToEdit(oid, resEditRowArr)
				}
			})
		}

	}


	// action on cancel button click
	function CancelEditResRow(oid)
	{
		var msg="\n\nAre you sure that you don't want to save these edited fields ?\nIf yes click - 'OK' or else click 'cancel'."

		// to show details on confirm popup and show edit button
		getEditSummary(oid, msg, "cancel");
	}


	function populateTeachesPriorNode(oid, field)
	{

		var app = "";
		
		$.ajax({
			type: "POST",
			url: "{% url 'drawer_widget' groupid %}",
			datatype: "html",
			data:{
				node_id: oid,
				field: field,
				app: app, // gapp name
				page_no: 1,
				csrfmiddlewaretoken: '{{ csrf_token }}'
			},
			success: function(data) {
				if(field == "teaches")
				{
					$("#teaches_drawer").html(data);
				}
				else if(field == "prior_node")
				{
					$("#prior_node_drawer").html(data);	
				}
			
				getDrawerVals();
				$("#teaches-overlay").attr("data-right-drawer-list", $("#teaches_list").val());
				$("#prior_node-overlay").attr("data-right-drawer-list", $("#prior_node_list").val());

			}
		});
	}
    

	// set inputbox to timepicker
	$('.time-required').timepicker({
		timeOnlyTitle: 'Choose Time Required',
		minDate: new Date(2050, 1, 1)
	});


	function getDrawerVals()
	{
                      
      	var pn_arr = [],
			cn_arr = [],
			md_arr = [], //for adding module
			tch_arr = [],  // for teaches
			assess_arr = []; // for assesses		

 		$(".node_id").each(function (){
			if ($(this).parent(".bullet-item").parent("#prior_node_drawer2").attr("id") == "prior_node_drawer2") {
				pn_arr.push($(this).val());
			}
			if ($(this).parent(".bullet-item").parent("#teaches_drawer2").attr("id") == "teaches_drawer2") {
				tch_arr.push($(this).val());
			}

			// if ($(this).parent(".bullet-item").parent("#collection_drawer2").attr("id") == "collection_drawer2") {
			// 	cn_arr.push($(this).val());
			// }

			// if ($(this).parent(".bullet-item").parent("#module_drawer2").attr("id") == "module_drawer2") {
  	// 			md_arr.push($(this).val());
  	// 		}
			// if ($(this).parent(".bullet-item").parent("#assesses_drawer2").attr("id") == "assesses_drawer2") {
				// assess_arr.push($(this).val());
			// }
		});

		$("#prior_node_list").val(pn_arr);
		$("#teaches_list").val(tch_arr);
		// $("#collection_list").val(cn_arr) ;
		// $("#module_list").val(md_arr);
		// $("#assesses_list").val(assess_arr);

	}

// </script>
{% endblock %}