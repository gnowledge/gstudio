{% extends "ndf/event.html" %}
{% load ndf_tags %}
{% load i18n %}
{% load pagination_tags %}

{% block head %}
  {{block.super}}

	<script type="text/javascript" src="/static/ndf/bower_components/jquery-ui/jquery-ui.min.js"></script> <!-- checked -->
	<script type="text/javascript" src="/static/ndf/bower_components/foundation-datepicker/js/foundation-datepicker.js"></script> <!-- checked -->
	<link rel="stylesheet" type="text/css" href="/static/ndf/bower_components/foundation-datepicker/stylesheets/foundation-datepicker.css"> <!-- checked -->
	<link rel="stylesheet" type="text/css" href="/static/ndf/bower_components/jquery-ui/themes/smoothness/jquery-ui.min.css"> <!-- checked -->
  <script src="/static/ndf/bower_components/moment/moment.js"></script> 
  <script src="/static/ndf/bower_components/jquery-ui/jquery-ui.js"></script> <!-- checked -->
  <script src="/static/ndf/bower_components/jqueryui-timepicker-addon/dist/jquery-ui-timepicker-addon.min.js"></script> <!-- checked -->
  <script src="/static/ndf/bower_components/jqueryui-timepicker-addon/dist/jquery-ui-sliderAccess.js"></script> <!-- checked -->
  <link rel="stylesheet" href="/static/ndf/bower_components/jqueryui-timepicker-addon/dist/jquery-ui-timepicker-addon.css"> <!-- checked -->
	<link rel="stylesheet" type="text/css" href="/static/ndf/bower_components/jquery-ui/themes/smoothness/jquery-ui.css"> <!-- checked -->
{% endblock %}

{% block style %}
  {{block.super}}
  /* CSS for Multiple-selection (or drawer) widget */
    .divider-line { font-size: xx-large; color:lightgray; }
    .line-height-2 { line-height:2; }
    .line-height-2pt5 { line-height:2.5; }
    .fontsize-x-large { font-size: x-large; }

    .margin-0 { margin: 0 !important ;}

    .resource-drawer { 
      border-color: #D3D3D3; border-style: solid; 
      padding: 0 !important; 
      overflow-y: auto;
    }

    .resource-drawer li.bullet-item:hover{
      background-color: #ecf0f1; cursor:pointer;
    }

    .posted-by{ color: #808080; font-size: small; }

    .selected-resource { background-color:lightgray !important ; }

    .resource-type-image {
      height:40px;    
      background-repeat:no-repeat; background-size: 48px 48px
    }

  /* Disable tab's (anchor tag's) click as it's navigation is propagated on buttons (Next & Previous) */
    dl.tabs>dd a.disable {
      pointer-events: none;
      cursor: default;
    }

    .row .row {
      margin: 0 0;
    }

  /* Resetting css-properties for fieldset (also legend, input) */
    /* fieldset (padding-bottom) */ 
    fieldset {
      padding: 1.25rem !important;
    }

    /* legend (background-color) */
    fieldset legend {
      background-color: transparent !important;
    }

    /* input (margin) */
    fieldset input {
      margin: 0 !important;
    }

  /* Setting css-properties for small.error */
    small.error {
      padding: 0 0 0 0.5rem !important;
      margin-top: 1rem !important;
      position: relative !important;
    }
{% endblock %}

{% block body_content %} 
  <form data-abide id="form-edit-node" method="POST" action="">
  {% csrf_token %}
  <header class="row" style="margin: 1rem 0 0 0;">
    <h2 class="medium-12 columns">
      {% if node %}
      {% trans "Editing Event:" %} {{node.name}}
      
      {% else %}
      {% trans "Create a New" %} {{title}} {% trans "Event" %}
      
      {% endif %}
    </h2>
  </header>

  <fieldset>
    <div class="row" style="margin-top: 0.5rem;">
       <div class="small-1 columns">
          <label for="{{property_order_list.0.1.9.name}}" class="right inline"> 
                {{property_order_list.0.1.9.altnames}}
          </label>
       </div>
       <div class="small-5 columns">
                     {% html_widget groupid node.pk property_order_list.0.1.9 %}
       </div>
            
       <div class="small-2 columns">
                 <label  class="right inline">
                    Course Name
                </label>
        </div>
        <div class="small-4 columns" align="left">
                 <select id="nussd_course_name" name="nussd_course_name" required>
                 </select>
         </div>
    </div>
        <!-- tab for batches -->
        
        <div class= "row">
            <div class="small-1 columns">
                 <label  class="right inline">
                    Batches</label>
            </div>
               <div class="small-4 columns" align="left">
                      <select id="event_has_batch" name="event_has_batch">
                      </select>
                      
               </div>
               
            
            {% if title == 'Exam' %}  
            <div class="small-1 columns">
              <label for="{{property_order_list.0.1.1.name}}" class="right inline"> 
                {{property_order_list.0.1.1.altnames}}
              </label>
            </div>
            <div class="small-3 columns">
                     {% html_widget groupid node.pk property_order_list.0.1.1 %}
            </div>
            <div class="small-1 columns" align="left">
              <label for="{{property_order_list.0.1.2.name}}" class="right inline"> 
                 {{property_order_list.0.1.2.altnames}}
              </label>
            </div>
            <div >
                     {% html_widget groupid node.pk property_order_list.0.1.2 %}
            </div>
         </div>   
         <div class="row">   
            <div class="small-12 columns" align="center">
              <input type="submit" id="submit" class="medium button" value="submit" >
            </div>
         </div>  
         {% else %} 
            <div class="small-7 columns">
                 <label><font color="red">*</font></label>
               </div>
              
         
         {% endif %}
        
        
 </div>    
         <div class= "row">
            <div class="small-12 columns" align="center">
                <input type="button" class="medium button" id="view" value="view">
           </div>
         </div>
      <div class="hiddensection" hidden>
      <input id="course_type" name="course_type">
      <input id="course_name" name="course_name">
      <input id="batch_name" name="batch_name">
      <input id="Module_name" name="Module_name">
      <input id="Session" name="Session">
      <select id="has_attendees" name="has_attendees" multiple="">
      </select>
              
      
      <input type="hidden" value=1 name="iteration" id="iteration">
      </div>
    
  </fieldset>

  <div id="Module-session-section">
    <fieldset >
      <div class="row">
        <div class="small-1 columns">
          <label class="right inline">
            {% trans "Module:" %}
          </lable>
        </div>
    
        <div class="small-4 columns">
          <select id="Module_of" name="Module_of" style="float:left; width:95%">
          </select>
          <i style="color:red; float:left display:inline">*</i>
        </div>

        <div class="small-1 columns">
          <label class="right inline">
            {% trans "Sessions:" %}
          </label>
        </div>
   
        <div class="small-4 columns end"> 
          <select id="session_of" name="session_of" style="float:left; width:95%">
          </select>
          <i style="color:red; float:left display:inline">*</i>
        </div>
      </div>

      <div class="row">
        <div class="small-1 columns">
          <label for="{{property_order_list.0.1.1.name}}" class="right inline"> 
            {{property_order_list.0.1.1.altnames}}
          </label>
        </div>
        <div class="small-2 columns">
          {% html_widget groupid node.pk property_order_list.0.1.1 %}
        </div>
          
        <div class="small-1 columns">
          <label for="{{property_order_list.0.1.2.name}}" class="right inline"> 
            {{property_order_list.0.1.2.altnames}}
          </label>
        </div>
        <div class="small-2 columns">
          {% html_widget groupid node.pk property_order_list.0.1.2 %}
        </div>
          
        <div class="small-2 columns">
          <label class="right inline">
            {% trans "Remainig time (in minutes):" %}
          </label>
        </div>
        <div id="available-minutes" class="small-1 columns end">
          <label  class="inline">0</label>
        </div>
        <div class="small-2 columns">
          <label class="right inline">
            {% trans "Alloted time (in minutes):" %}
          </label>
        </div>
        <div id="Alloted-minutes" class="small-1 columns end">
          <label  class="inline">0</label>
        </div>  
      </div>
   
      <!-- section for start time and end time -->
      <div class="row" id="Split_Session">
        <!-- checkbox for yes or no  split session  -->
        <div class="small-11 small-offset-1 columns end">
          <input type="checkbox" class="splitsession" id="splitsession" onClick="ShowSplits()">{% trans "Split Session" %}
          
          <div id="select_split">
            <hr/>
            <!--
            <div style="width:200px;">
            </div>
            -->
            
            <div id="splits" class="row">
              <div id="split-2" class="small-1 columns" >
                <input type="radio" id="chkbxsplit-2" name="splitinto" onClick="GenerateSplits('2')" value="2" style="right-padding:2px;">2
              </div>
              
              <div id="split-3" class="small-1 columns end">
                <input type="radio" id="chkbxsplit-3" name="splitinto" onClick="GenerateSplits('3')" value="3" style="right-padding:2px;">3
              </div>
              
              <!-- Div for Appended Start_Date And End Date -->
              <div id="date-splits" class="small-12 columns">
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top: 1em;">
        <div class="small-2 columns">
          <label class="right inline"> 
            {% trans "Voluntary Teacher" %}
          </label>
        </div>
        <div class="small-5 columns">
          <select id="event_coordinator" name="event_coordinator" required style="float:left; width:95%">
          </select>
          <i style="color:red; float:left display:inline">*</i>
        </div>

        <div class="small-4 columns end">
          <!-- keept for spacing from left hand side -->        
        </div>
      </div>
            </fieldset>  
      
         
        <div class="row">
       <div class="small-12 columns" align="center">
      <input type="submit" id="submit" class="medium button" value="submit" >
       </div>
       </div>
 <!-- div module sesion section Opens here" -->
 </div>
</div>
 
  </form>
  
  
  

{% endblock %}

{% block script %}

function ShowSplits()
  {
      if (document.getElementById('splitsession').checked == true)
        {
            document.getElementById("select_split").hidden=false;
        }
      if (document.getElementById('splitsession').checked == false)
        {
          document.getElementById("select_split").hidden=true;
          //$("#date-splits").empty();
        }

  }
function GenerateSplits(splits){
  //document.getElementById('start_time').value = ""
  //document.getElementById('end_time').value = ""
  var i=1;
  if (splits == 2)
  {
      $("#date-splits").empty();
  
  }
  if( !(document.getElementById("start_time_1")) )
  {
  $("#date-splits").append("<div class='row'> <div class='small-1 columns' align='right' > <label> <b>Split -1 </b></label> </div></div>")
  $("#date-splits").append("<div class='row' align='left'>"+ 
  " <div class='small-1 columns' align='center' >"+ 
    "<label for='start_time_1' class='right inline'> {% trans "Start time" %} </label>"+
  "</div>"+
  "<div class='small-2 columns' > "+
     "<input id='start_time_1' class='date_month_day_year' type='text' onClick='datetime()' style='float:left; width:10rem' required  placeholder='DD/MM/YYYY HH:MM' value='' name='start_time_1' readonly=''>"+
  "</div>"+
  
  " <div class='small-1 columns'>"+
      "<label for='end_time_1' class='right inline'> {% trans "End time" %} </label></div>"+
   ""+ "<div >"+
     "<input id='end_time_1' class='date_month_day_year' type='text' onClick='datetime()' style='float:left; width:10rem' required  placeholder='DD/MM/YYYY HH:MM' value='' name='end_time_1' readonly=''>"+
      "</div></div>")
  } 
   if(splits == '3')
   {
  $("#date-splits").append("<div class='row' style='margin-top: 1em;'> <div class='small-1 columns' align='right' > <label> <b>{% trans "Split-2" %}</b></label> </div></div>")
  $("#date-splits").append("<div class='row' align='left'>"+ 
  " <div class='small-1 columns' align='center' >"+ 
    "<label for='start_time_2' class='right inline'> {% trans "Start time" %} </label>"+
  "</div>"+
  "<div class='small-2 columns' > "+
     "<input id='start_time_2' class='date_month_day_year' type='text' onClick='datetime()' style='float:left; width:10rem' required placeholder='DD/MM/YYYY HH:MM' value='' name='start_time_2' readonly=''>"+
  "</div>"+
   " <div class='small-1 columns'>"+
      "<label> End time </label></div>"+
   ""+ "<div >"+
     "<input id='end_time_2' class='date_month_day_year' type='text' onClick='datetime()' style='float:left; width:10rem' required  placeholder='DD/MM/YYYY HH:MM' value='' name='end_time_2' readonly=''>"+
      "</div></div>")
   
    $("#iteration").attr('value','3')
    
  }
  else
  {
      $("#iteration").attr('value','2')
      date_validation($('#end_time').attr('name'))
  }
     
  
   
}


$(document).ready(function(){
 document.getElementById('form-edit-node').reset()
 datetime()
 if (!'{{node}}')
   {clear_Disable_Elements();
   }
 
 if ('{{node}}')
 {
  
    $('#view').hide()
 }  
 var event_details=""
 
 $('#select_split').attr('hidden','True')
 event_details="{{edit_details|safe}}"

  if(event_details)
  {
    event_details={{edit_details|safe}}
    $('#nussd_course_name').append(
                  $("<option></option>")
                  .attr('id',event_details['course'].course_id)
                  .attr('value',event_details['course'].course_id)
                  .text(event_details['course'].course)
                  );
    var a=event_details['course'].course                
    $("select[name='nussd_course_name'] option[value= a]").prop("selected", true);       
    document.getElementById('nussd_course_name').disabled = "";
    $('#event_has_batch').append(
                 $("<option></option>")
                  .attr('id',event_details['batch'].batchid)
                  .attr('value',event_details['batch'].batchid)
                  .text(event_details['batch'].batchname)
                  );
    var a=event_details['batch'].batchname                
    $("select[name='batch'] option[value= a]").prop("selected", true);       
    document.getElementById('Module_of').disabled = "";
                 $('#Module_of').append(
                 $("<option></option>")
                 .attr('id',event_details['Module'].Moduleid)
                 .attr('value',event_details['Module'].Moduleid)
                 .text(event_details['Module'].Modulename)
                  );
    var a=event_details['Module'].Modulename                
    $("select[name='Module_of'] option[value= a]").prop("selected", true);       
    document.getElementById('event_coordinator').disabled = "";
                 $('#event_coordinator').append(
                       $("<option></option>")
                      .attr('id',event_details['cordinator'].cordinatorid)
                      .attr('value',event_details['cordinator'].cordinatorid)
                      .text(event_details['cordinator'].cordinatorname)
                      );
    var a = event_details['cordinator'].cordinatorname
    $("select[name='event_coordinator'] option[value= a]").prop("selected", true);       
    
    enable_submit()
   $('#session_of').append(
          $("<option></option>")
                      .attr('id',event_details['session'].sessionid)
                      .attr('value',event_details['session'].sessionid)
                      .text(event_details['session'].sessionname)
                      .attr('minutes',event_details['session'].sessionminutes)
                      );
    var event_session = event_details['session'].sessionname
    total_session_time = event_details['session'].sessionminutes
    $("#available-minutes").empty()
    $("#available-minutes").append("<label for='end_time' class='inline'>"+total_session_time+"<label>")
    $("select[name='session_of'] option[value= event_session]").prop("selected", true);       
    document.getElementById('event_has_batch').disabled = "";
    Enable_Elements()     
    var course_type=$("#event_has_batch").val()  
      $.ajax({
          url: "{% url 'fetch_batch_student' groupid 'course_type' %}".replace('course_type',String(course_type)),
          type: "GET",
          success: function(data){
              courses=JSON.parse(data)
              },
          complete:function(){
                if(courses != ""){
                $.each(courses, function(key,val) {
                     $('#has_attendees').append(
                     $("<option></option>")
                     .attr("id", "coursename_"+key.id)
                     .attr("value",val.id)
                     .attr("selected","selected")
                     .text(val.name)
            
           );
            });
          }
          } 
    });
} 
});
function Enable_Elements()
{
  if(  document.getElementById('Module_of'))
  {
     document.getElementById('Module_of').disabled = "";
  }
    document.getElementById('Module-session-section').visible = "True";
    document.getElementById('view').disabled = "";
}
function clear_Disable_Elements()
{
  $('#nussd_course_name').attr('disabled','True')
  $('#nussd_course_name').empty()
  $('#event_has_batch').attr('disabled','True')
  $('#event_has_batch').empty()
  $('#session_of').attr('disabled','True')
  $('#splitsession').attr('disabled','True')
  $('#session_of').empty()
  $('#Module_of').attr('disabled','True') 
  $('#Module_of').empty()
  if ( '{{title}}' == 'Exam' )
  {
      $('#Module-session-section').empty()
      $('#view').hide()
  }
  else{

  $('#Module-session-section').hide()
  $('#event_coordinator').attr('disabled','True')
  $('#start_time_1').attr('disabled','True')
  $('#end_time_1').attr('disabled','True')
  $('#start_time_1').attr('disabled','True')
  $('#end_time_1').attr('disabled','True')
  $('#end_time').attr('disabled','True')

  }

  $('#view').attr('disabled','True')
  enable_submit()
  
}
/*var startDtInput = $("#start_time")
var $a=$('#split-into3')
$('body').click(function(e)
  {
    var target = $(e.target), article;
    if(target.is('#split-into2'))
    {
        $a=$('#split-into2')
    }
    else if(target.is('#split-into3'))
    {
          $a=$('#split-into3')
    }
});
*/
/*
$('#split-into3').click(function(){
  var counter=$('#split-into3').val();
  /*for (i=1;i<counter;i++){
     var $elem=$("#start_time").clone()
     var $a=$elem.attr("id","start_time_"+i).attr("name","start_time_"+i)
     $a.appendTo(".session_time")
  }
});
*/

/*
$('#split-into2').click(function(){
   $('#iteration').attr('value','2')
  var counter=$('#split-into2').val()
/*
  for (i=1;i<counter;i++){
     var $elem=$("#start_time").clone(true)
     var $a=$elem.attr("id","start_time_"+i).attr("name","start_time_"+i)
     $a.appendTo(".session_time")
  }
   
});

*/


$("#view").click(function(){

  if(!$("#nussd_course_name").val()  || ($("#nussd_course_name").val() == "Select Course Name"))
  {
      alert("Please Select Course Name")
  }
  else
  {
    var sel_coursename=$("#nussd_course_name").val();
    $('#Module-session-section').show()
    $.ajax({
      url: "{% url 'fetch_course_Module' groupid 'sel_coursename' %}".replace('sel_coursename',String(sel_coursename)),
      type: "GET",
      datatype:"json",
      success: function(data){
      courses=JSON.parse(data)
      course=JSON.parse(courses.Module)
      trainer=JSON.parse(courses.trainer)
      },
     complete:function(){
      if(course != ""){
                  $('#Module_of').empty()
                  $('#Module_of').append($("<option></option>").attr("value","Select Module Name").text("--- Select Module ---"))
                  $.each(course, function(key,val) {
                  $('#Module_of').append(
                  $("<option></option>")
                      .attr("id", "coursename_"+key.id)
                      .attr("value",val.id)
                      .text(val.name)
                   );
                });
            Enable_Elements()
       }  
       else
       {
            alert("No Module Exists for this Course type!!!")
       
       }   
      if (trainer!=""){   
         $('#event_coordinator').empty()
         $('#event_coordinator').append($("<option></option>").attr("value","Select Trainer").text("--- Select Trainer ---"))
         $.each(trainer,function(key,val){
              $('#event_coordinator').append(
                 $("<option></option>")
                  .attr("id", "coursename_"+key.id)
                  .attr("value",val.id)
                  .text(val.name)
                  );
                  
                });   
          
          }
          else
          {
            clear_Disable_Elements();
          alert("No Trainers have being Assinged to this Course !!!")
          }
          } 
      });

}


   

});

$("#nussd_course_name").change(function(){

  
  var course_type=$("#nussd_course_name").val()  
  var course_name=$("#nussd_course_name option:selected ").text()

  $('#course_name').val(course_name)
  $.ajax({
  
      url: "{% url 'fetch_course_batches' groupid 'course_type' %}".replace('course_type',String(course_type)),
      type: "GET",
      success: function(data){
      courses=JSON.parse(data)
      
      },
     complete:function(){
      $('#event_has_batch').empty()
      $('#event_has_batch').append($("<option></option>").attr("value","Select Course Name").text("--- Select Batch ---"))
      if(courses != ""){
              $.each(courses, function(key,val) {
                    $('#event_has_batch').append(
                    $("<option></option>")
                    .attr("id", "coursename_"+key.id)
                    .attr("value",val.id)
                    .text(val.name)
                    );
               });
          document.getElementById('event_has_batch').disabled = "";
          }
          else
          {
          alert("No Batches Found")
          
          document.getElementById('nussd_course_name').disabled = "";
          $('#Module-session-section').hide()
          $('#event_has_batch').attr('disabled','True')
          $('#view').attr('disabled','True')
          }
              
  
          } 
      });



});

$("#event_has_batch").change(function(){
   Enable_Elements()
    var batch_name=$("#event_has_batch option:selected ").text()

  $('#batch_name').val(batch_name)
  
    var course_type=$("#event_has_batch").val()  
    $.ajax({
        url: "{% url 'fetch_batch_student' groupid 'course_type' %}".replace('course_type',String(course_type)),
        type: "GET",
        success: function(data){
            courses=JSON.parse(data)

        },
      complete:function(){
        if(courses != ""){
            $('#has_attendees').empty()
            $.each(courses, function(key,val) {
                $('#has_attendees').append(
          $("<option></option>")
            .attr("id", "coursename_"+key.id)
            .attr("value",val.id)
            .attr("selected","selected")
            .text(val.name)
            
           );
            });
          }
          } 
      });



});



$("#Module_of").change(function(){
  
var course_type=$("#Module_of").val()  
  var Module_of=$("#Module_of").text()
  $("#Module_name option:selected ").val(Module_of)
  

  $.ajax({
      url: "{% url 'fetch_course_session' groupid 'course_type' %}".replace('course_type',String(course_type)),
      type: "GET",
      data:{"app_set_id":'{{app_set_id}}'},
      success: function(data){
      courses=JSON.parse(data)

      },
     complete:function(){
      if(courses != ""){
         $('#session_of').empty()
         $('#session_of').append($("<option></option>").attr("value","Select Session Name").text("--- Select Session ---"))
          $.each(courses, function(key,val) {
              $('#session_of').append(
               $("<option></option>")
                .attr("id", "coursename_"+key.id)
                .attr("minutes",val.minutes)
                .attr("value",val.id)
                .text(val.name)
                );
             });
          document.getElementById('session_of').disabled = "";
          }
     else
     {
          document.getElementById('session_of').disabled = "True";
          alert("No Session Found!!!")
       
     }     
          
          
          }
           
      });



});
var total_session_time = 0
var deducted_minute = 0
$("#session_of").change(function(){

  total_session_time = $('#session_of option:selected').attr('minutes')
  var session_of=$('#session_of option:selected').text()
  $("#Session").val(session_of)
  document.getElementById('event_coordinator').disabled = "";      
  $("#available-minutes").empty()
  $("#available-minutes").append("<label for='end_time' class='inline'>"+total_session_time+"<label>")
  $("#Alloted-minutes").empty()
  $("#Alloted-minutes").append("<label for='end_time' class='inline'>"+total_session_time+"<label>")
});

function enable_submit()
{
  vt_selected_index = $("#event_coordinator :selected").index();
  if (total_session_time == 0 && vt_selected_index != 0 ){
      document.getElementById('submit').disabled = "";      
  }
else 
{
    document.getElementById('submit').disabled = true;      
}

if('{{node}}')
 {
  document.getElementById('submit').disabled = "";      
 }


}

$('#event_coordinator').change(function(){
  
 enable_submit()
});


$("#nussd_course_type").change(function(){
  clear_Disable_Elements()
  var course_type=$("#nussd_course_type").val()
  var courses=""
  $("#course_type").val(course_type)
  
  $.ajax({
      url: "{% url 'get_announced_courses_with_ctype' groupid  %}",
      type: "GET",
      dataType: "json",
      data:{'nussd_course_type':course_type},
      success: function(data){
      ac_data = data["acourse_ctype_list"]
      ac_message=data.message
      if(ac_data)
       {courses = JSON.parse(ac_data)
      
      }},
     complete:function(){
      if(courses != ""){
             $('#nussd_course_name').append($("<option></option>").attr("value","Select Course Name").text("--- Select Course Name ---"))
             $.each(courses, function(key,val) {
                 se = val["_id"];
                 ac_name=val["name"];
                 $('#nussd_course_name').append(
                 $("<option></option>")
                 .attr("id", "coursename_"+se)
                 .attr("value",se)
                 .text(ac_name)
                    );
              document.getElementById('nussd_course_name').disabled = "";
              });
              
      }
      else
      {
            alert(ac_message)
      }
          
          
  
          }
           
      });



});

// Tranferring values from multiple selection widget into outer dropdown -----------------------------------------
  $(document).on('closed', '[data-reveal]', function () {
    /*
     *  On closing of reveal-modal
     */
    var widget_for = $(this).attr('id').replace('_modal', '')

    // First empty all values of given field (dropdown/select)
    $("select#" + widget_for).empty();

    // Fetching class name of hidden input element(s) of drawer2 from corresponding drawer-widget
    class_value = ".node_id." + widget_for + "_values"
    right_drawer_len = $(class_value).size()

    if (right_drawer_len > 0) {
      $(class_value).each(function (){
        // ObjectId & name of the resource inside drawer2 from corresponding drawer-widget
        resource_id = $(this).val()
        resource_name = $(this).attr('name')

        // Make very first entry as given below
        $("select#" + widget_for).append(
            $("<option></option>")
              .attr("value", resource_id)
              .attr("selected", "selected")
              .text(resource_name)
        );
      });
    }

    else {
      // Make very first entry as given below
      $("select#" + widget_for).append(
          $("<option></option>")
            .attr("value", "")
            .text("- - - Select - - -")
      );
    }
  });
  
function date_validation(name)
{

  var start_time=""
  var end_time=""
  str=name.substring(9)
  str2=name.substring(0,3)
  if (str2 == 'end' )
  {

     if (str)
      {
         start_time = new Date($('#start_time_'+str).datetimepicker('getDate')) 
         end_time = new Date($('#end_time_'+str).datetimepicker('getDate'))  
         

      }
      
     if(!(str))
      {
        start_time = new Date($('#start_time').datetimepicker('getDate')) 
        end_time = new Date($('#end_time').datetimepicker('getDate'))  
        
      }
        reset_session_variable(str)
        deduct_time(start_time,end_time)
    if (total_session_time <= 0 )
     {
      if(total_session_time < 0)
      {
          alert("Please schedule session within given allotted time!")
      }
       show_hide_date(str)     
     }
     else
     {
       document.getElementById('splitsession').disabled="";
       if (document.getElementById('splitsession').checked == true)
        {
            if (document.getElementById("start_time_"+(Number(str)+1)))
            {
                document.getElementById("start_time_"+(Number(str)+1)).disabled=""
            }
        }
       
     }
   }
   set_end_date_time(name)
}  

function deduct_time(start_time,end_time)
{    var difference = start_time.getTime() - end_time.getTime();
     var daysDifference = Math.floor(difference/1000/60/60/24);
     difference -= daysDifference*1000*60*60*24
     var hoursDifference = Math.floor(difference/1000/60/60);
     difference -= hoursDifference*1000*60*60
     var minutesDifference = Math.floor(difference/1000/60);
     difference -= minutesDifference*1000*60 
     var secondsDifference = Math.floor(difference/1000);
     diffhh = 23-hoursDifference
     diffmm = 60-minutesDifference
     total_min_diff=((Number(diffhh)*60) + Number(diffmm))
     deducted_minute =  Number(total_session_time) - Number(total_min_diff)
     total_session_time=deducted_minute
     $("#available-minutes").empty()
     $("#available-minutes").append("<label for='end_time' class='inline'>"+total_session_time+"<label>")
     /* temprory path */
     if ( total_session_time !=0 )
     {
          document.getElementById('submit').disabled = true;      
     }
}

function show_hide_date(str)
{
    if (!(str))
    {  
       document.getElementById('select_split').hidden=true 
       document.getElementById('splitsession').checked=false
       document.getElementById('chkbxsplit-2').checked=false
       document.getElementById('chkbxsplit-3').checked=false
       document.getElementById('splitsession').disabled=true;
       $("#date-splits").empty();
       $("#iteration").attr('value','1')
    }
    if(str ==1)
    {
        $('start_time_2').hide()
        $('end_time_2').hide()
         $("#iteration").attr('value','2')
    }
    
}
function reset_session_variable(str)
{
var start_time=""
var end_time=""

  if (!(str))
      {
       total_session_time=$('#session_of option:selected').attr('minutes')
       if (document.getElementById('start_time_1')){
       document.getElementById('start_time_1').value=""}
       if ( document.getElementById('end_time_1')){
       document.getElementById('end_time_1').value=""
       }
       if(document.getElementById('start_time_2')){
       document.getElementById('start_time_2').value=""}
       if ( document.getElementById('end_time_2')){
       document.getElementById('end_time_2').value=""
       }
        }
  if(str == 1)
  { 
     total_session_time=$('#session_of option:selected').attr('minutes')
     start_time = new Date($('#start_time').datetimepicker('getDate')) 
     end_time = new Date($('#end_time').datetimepicker('getDate'))  
     if(document.getElementById('start_time_2')){
       document.getElementById('start_time_2').value=""}
       if ( document.getElementById('end_time_2')){
       document.getElementById('end_time_2').value=""
       }  
     deduct_time(start_time,end_time) 
  } 
  if (str == 2){
        total_session_time=$('#session_of option:selected').attr('minutes')
        start_time = new Date($('#start_time').datetimepicker('getDate')) 
        end_time = new Date($('#end_time').datetimepicker('getDate'))  
        deduct_time(start_time,end_time)
        start_time = new Date($('#start_time_1').datetimepicker('getDate')) 
        end_time = new Date($('#end_time_1').datetimepicker('getDate'))  
        deduct_time(start_time,end_time)
        
   }
        
}

function set_end_date_time(num){
   var str=num.substring(11)

       
    if (str)
    { 

      $("#end_time_"+str+"").datepicker('option','minDate', $("#start_time_"+ str +"").datetimepicker('getDate'));
      $("#end_time_"+str+"").timepicker('option','minDate', $("#start_time_"+ str +"").datetimepicker('getDate'));
      $("#end_time_"+str+"").timepicker('option','hourMin', $("#start_time_"+  str +"").datetimepicker('getDate').getHours());
      $("#end_time_"+str+"").timepicker('option','minuteMin',$("#start_time_"+ str +"").datetimepicker('getDate').getMinutes());
      document.getElementById("end_time_"+str).disabled=""
      
    }
    if (!(str))
    {
    
    $("#end_time").datepicker('option','minDate', $("#start_time").datetimepicker('getDate'));
    $("#end_time").timepicker('option','minDate', $("#start_time").datetimepicker('getDate'));
    $("#end_time").timepicker('option','hourMin',$("#start_time").datetimepicker('getDate').getHours());
    $("#end_time").timepicker('option','minuteMin',$("#start_time").datetimepicker('getDate').getMinutes());
    document.getElementById('end_time').disabled=""
    }
    
}    

function datetime(){  
currentDate = new Date();
var currentDay = currentDate.getDate();
var currentMonth = currentDate.getMonth();
var currentYear = currentDate.getFullYear();
  $(".date_month_day_year").datetimepicker({
       
      changeMonth: true,
      dateFormat: 'dd/mm/yy',
      
      minDate: '0',
      maxDate: '+2m',
      defaultDate: '0',
      hourGrid: 6,
      minuteGrid: 15,
      onClose: function(dateText, inst) {
        $(this).val(dateText);

        if ( '{{title}}' != 'Exam' )
        {
          date_validation($(this).attr('name'))
          enable_submit()
        }  

          
        var month_year = $(this).val();
        day = currentDay;
        month = currentMonth;
        year = currentYear;
      },

      beforeShow: function() {
        var month_year = $(this).val();
        day = currentDay;
        month = currentMonth;
        year = currentYear;

        if (month_year) {
          month_year = month_year.split("/");
          day = parseInt(month_year[0]);
          month = parseInt(month_year[1]);
          year = parseInt(month_year[2]);
        }
        $(this).datetimepicker('option', 'defaultDate', new Date(year, (month-1), day));
        $(this).datetimepicker('setDate', new Date(year, (month-1), day));
      },
    });
}

$("#submit").click(function() {

  $('article').block({ 
    message: '<h4>Processing... Please wait!</h4>',
    css: { 
      border: 'none', 
      padding: '15px', 
      color: '#fff !important', 
      backgroundColor: '#10c1cb !important', 
      '-webkit-border-radius': '10px', 
      '-moz-border-radius': '10px', 
      opacity: 1.0
    }
  });
});

{% endblock %}


