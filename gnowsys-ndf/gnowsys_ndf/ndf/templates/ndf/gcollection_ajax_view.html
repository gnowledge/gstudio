{% load ndf_tags %}
{% load i18n %}

{% block head %}
{% get_node_type node as node_type %}  

<style type="text/css">
  .accordion-resources {
    font-size: x-small;
  }

  .accordion-unit-name {
    font-size: normal;
    padding-top: 10px;
  }

  .accordion-sub-section {
    list-style: none;
  }

  .accordion-section-name {
    font-size: xx-large;
    font-weight: thin;
  }
</style>

{% for section in course_collection_data %}
  {% if section.node_type == 'CourseSectionEvent' %}
    <dl class="accordion" data-accordion>
      <!-- sections -->
      <dd class="accordion-navigation">
        <a href="#s{{section.id}}" class="accordion-section-name">{{section.name}} <span class="right">{{section.children|length}}</span></a>
        <div id="s{{section.id}}" class="content active">
          <!-- sub sections  -->
          {% for sub_section in section.children %}
            {% if sub_section.node_type == 'CourseSubSectionEvent' %}
            <strong class="accordion-sub-section-name">{{sub_section.name}} <span class="right">{{sub_section.children|length}}</span></strong>
              <ul class="accordion-sub-section">
              <!-- units -->
                {% for unit in sub_section.children %}
                  {% if unit.node_type == 'CourseUnitEvent' %}
                    <li class="accordion-unit">
                    <div class="accordion-unit-name">{{unit.name}} <span class="right">{{unit.children|length}}</span></div>
                    <!-- resources -->
                    {% for resource in unit.children %}
                      <label class="accordion-resource">
                        <a href="#" class="load-on-click" id="{{resource.id}}">{{resource.name}}</a>
                      </label>
                    {% endfor %}
                    <!-- resources end -->
                    </li>
                  {% endif %}
                {% endfor %}
                <!-- units end -->
              </ul>
            {% endif %}
          {% endfor %}
          <!-- sub sections end -->
        </div>
      </dd>
    </dl>
  {% endif %}
{% endfor %}
<!-- sections end -->

<!-- script to handle ajax of .accordion & #view_page -->
<script>

$('.load-on-click').on('click', function(e) {
  var node = { id: e.target.id };
  var node_type = "{{node_type}}";
  var nav_list = [];

  $.ajax({
      type: "POST",
      url: "{% url 'collection_nav' group_id %}",
      datatype: "html",
      data:{
        node_id: node.id,
        curr_node:"{{node.pk}}",
        nav: nav_list,
        nod_type: node_type,
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      success: function(data) {
        if (node_type == "Page"){
         window.history.pushState("", "", "/{{group_name_tag}}/page/{{node.pk}}"+"?selected="+node.id+"");
        }
        else if(node_type == "File"){
          window.history.pushState("", "", "/{{group_name_tag}}/file/{{node.pk}}"+"?selected="+node.id+"");  
        }
        else if (node_type == "Term"){
          window.history.pushState("", "", "/{{group_name_tag}}/term/{{node.pk}}"+"?selected="+node.id+"");
        }
        else if (node_type == "Course"){
          window.history.pushState("", "", "/{{group_id}}/course/course_detail/{{node.pk}}"+"?selected="+node.id+"");
        }
        if (node_type == "CourseEventGroup" || node_type == "ProgramEventGroup"){
          window.history.pushState("", "", "/{{node.pk}}"+"?selected="+node.id+"");
          $(".view_page_link").trigger('click')
        }
        else if (node_type == "Topic"){
          window.history.pushState("", "", "/{{group_name_tag}}/topic_details/{{node.pk}}"+"?selected="+node.id+"");
        }
                            
        $("#view_page").html(data);
      }
  });
});
</script>

{% endblock %}
