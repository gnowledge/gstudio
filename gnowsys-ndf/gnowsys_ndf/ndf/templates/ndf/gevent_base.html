{% load simple_filters %}
{% xextends "ndf/gbase.html" with first_body_column=0 %}
{# {% extends "ndf/gbase.html" %} #}
{% load i18n %}
{% load cache %}
{% load ndf_tags %}
{% block title %}{% trans 'Events' %} -- khaal version {% endblock %}

{% block style %}
.course_outline_table, tr {
border: 2px solid #0b8a91 !important;
border-collapse: collapse;
}

.gray-text{
color: gray;
}

#content > p { color: #6F6F6F !important; /*font-size: inherit;*/ }

tr:hover{
cursor:pointer;
}

.tab{
padding-left: 2em;
background-color:yellow !important;
}

.tab2{
padding-left: 4em;
}

#eventModal > label {
color: white;
font-weight: bold;
font-size: 1rem;
}

.all_blogs{
overflow-y: auto;
height:500px;
}

.jqtree-tree .jqtree-title {
margin: 5px;
font-size: 15px;
color: black !important;
/*Change the color here to change font color of tree*/
}

li.remove-dot{
list-style: none;

}


{% endblock %}

{% block head %}
<script type="text/javascript" src="/static/ndf/orgitdown/jquery.orgitdown-foundation.js"></script>
<!-- orgitdown! toolbar settings -->
<script type="text/javascript" src="/static/ndf/orgitdown/skins/gstudio/set.js"></script>
<!-- orgitdown! skin -->
<link rel="stylesheet" type="text/css" href="/static/ndf/orgitdown/skins/gstudio/style.css" />
{% endblock %}

{% block extended_header %}
{% endblock %}
{% block body_content %}
{% check_is_gstaff groupid request.user as gstaff_access %}
{% user_access_policy groupid request.user as user_access %}

<div id="eventModal" class="reveal-modal medium alert-box radius" data-reveal data-alert>
  <label id="eventModalLabel"></label>
  <a class="close-reveal-modal">&#215;</a>
</div>
{% comment %}
<div id="view-page" class="small-12 large-12 columns"></div>
{% endcomment %}

<div id="envelop-cover">
  <div class="row course-page-title">
    <div class="small-12 medium-8 columns heading">{{node.name}}</div>

      {% check_is_gstaff groupid request.user as is_gstaff %}
      {% if is_gstaff %}
      <span><a href="{% url 'edit_event_group' groupid sg_type %}" class="tiny button radius"><i class="fi-pencil"></i> {% trans "Edit " %}{% if sg_type == "ProgramEventGroup" %}{% trans "Event" %}{% else %}{% trans "eCourse" %}{% endif %}</a></span>

        <span><a class="tiny button radius" href="{% url 'create_course_struct' group_id node.pk %}">{% if course_structure_exists %}{% trans "Edit Course Structure" %}{% else %}{% trans "Add  Course Structure" %}{% endif %}</a></span>
        <span><input type="button" class="tiny button radius settings" value="Settings"></span>
      {% else %}
        <ul class="right">
          <li class="enroll-btn-li remove-dot">
          {% if user_access == "allow" %}
            <input class="button tiny" type="button" value="ENROLLED" disabled="disabled">
          {% else %}
            {% if user.is_authenticated %}
              {% if allow_to_join == "Open" %}
                <input class="enroll-btn button tiny" type="button" value="ENROLL">
              {% else %}
                <input class="button tiny" type="button" value="Enrollment {{allow_to_join}}" disabled="disabled">
              {% endif %}
            {% else %}
                <a href="{% url 'auth_login' %}" class="button tiny" title="Please login to Enroll">ENROLL</a>
            {% endif %}
          {% endif %}
          </li>
        </ul>
      {% endif %}

    <div class="small-12 medium-4 columns">
      <label>2 out of 6 modules completed</label>
      <div class="progress success round">
      <div class="meter" style="width: 20%"></div>
      </div>
    </div>
  </div>
  <div class="row collapse meta">
    <div class="key">Starts on</div>
    <div class="value">
      <div class="time"> Jan 5 2016 &#8226; 3:00pm </div>
    </div>
  </div>
  <div class="row collapse meta">
    <div class="key">Next Session</div>
    <div class="value">
      <div class="name">Taking Screenshots of the work</div>
      <div class="time"> Jan 5 2016 &#8226; 3:00pm </div>
    </div>
  </div>
</div>



<!-- Tabs -->
<div class="row" id="envelop-content" >
  <!-- Envelop box-->
  <div class="small-12 large-12 columns">
     <div style="line-height: 0.7em;">
      <ul class="tabs">

        <li class="tab-title {% ifequal title 'dashboard' %}active{% endifequal %}">
          <a href="{% url 'course_dashboard' group_id %}">
            <i class="fi-clipboard-notes"></i>{% trans "Dashboard" %}
          </a>
        </li>

        <li class="tab-title {% ifequal title 'course content' %}active{% endifequal %}">
          <a href="{% url 'course_content' group_id %}">
            <i class="fi-clipboard-notes"></i>{% trans "Course Content" %}
          </a>
        </li>

        <li class="tab-title {% ifequal title 'notebook' %}active{% endifequal %}">
          <a href="{% url 'course_notebook' group_id %}">
            <i class="fi-book "></i>{% trans "Notebook" %}
          </a>
        </li>

        <li class="tab-title {% ifequal title 'raw material' %}active{% endifequal %}">
          <a href="{% url 'course_raw_material' group_id %}">
            <i class="fi-clip "></i>{% trans "Raw Material" %}
          </a>
        </li>

        <li class="tab-title {% ifequal title 'gallery' %}active{% endifequal %}">
          <a href="{% url 'course_gallery' group_id %}">
            <i class="fi-photo "></i> {% trans "Gallery" %}
          </a>
        </li>

        <li class="tab-title {% ifequal title 'about' %}active{% endifequal %}">
          <a href="{% url 'course_about' group_id %}">
            <i class="fi-page-edit "></i>{% trans "About the course" %}
          </a>
        </li>

      </ul>
    </div>



    <!-- Each tab pages -->
    <div class="tabs-content course-book">
      <div class="content active" id="course-dashboard">
        {% include "ndf/gcourseDashboard.html" %}
      </div>
      <div class="content" id="course-content">
        <!--@anotation("import gcourse_event_group.html for the list of the modules in the course.")-->
        {% include "ndf/gcollection_ajax_view.html" %}
      </div>
      <div class="content" id="course-notebook">
      {% comment %}
        <div class="text-right">
          <a href="{% url 'page_create_edit' node.pk %}?course_event_id={{node.pk}}&blog_type=True" class="button small radius"> Add Blog </a>
        </div>
        <div class="row all_blogs">
          {% for each_blog in blog_pages %}
          <div class="blogpage"  style="margin-left:10px;">
            <h4>
              <a href="{% url 'page_details' group_id each_blog.pk %}">{{each_blog.name}}</a>
            </h4>
            {% if request.user.id == each_blog.created_by or gstaff_access %}
            <a class="fi-pencil" href="{% url 'page_create_edit' node.pk each_blog.pk %}?course_event_id={{node.pk}}&blog_type=True"> Edit </a>
            {% endif %}
            <span>
              Created by {{each_blog.created_by|get_username}} at {{each_blog.created_at}}
            </span>
            <div>
              {{each_blog.html_content|safe}}
            </div>
          </div>
          <hr/>
          {% empty %}
          <div class="blogpage"  style="margin-left:10px;">
            <h4>
              <u>
                <a href="{% url 'page_create_edit' node.pk %}?course_event_id={{node.pk}}&blog_type=True">Start writing Pages </a>
              </u>
            </h4>
          </div>
          {% endfor %}
        </div>
      {% endcomment %}

        <!--Including the nodebook component-->
          {% include "ndf/gnotebook.html" %}
        <!---->

      </div>
      <div class="content" id="course-raw-material">
        <p></p>
      </div>
      <div class="content" id="course-gallery">
        {% if "CourseEventGroup" in group_object.member_of_names_list %}
        <!--div id="upload_form_div" class="text-right">
          <form class="dropzone" id ="docPost" enctype="multipart/form-data" method="post" action="{% url 'upload_using_save_file' group_id %}">
            {% csrf_token %}
            <input type="file" name="doc" id="docFile"/>
            <div class="save_cancel hide">
              <input type="submit" id="submitpostid" class="tiny button radius" value="Save"/>
              <input type="button" id="btnUploadCancel" class="tiny button radius" value="Cancel"/>
            </div>
          </form>
        </div-->
        {% endif %}

        <!--div class="row">
         {# include "ndf/file_list_tab.html" with resource_type=files_cur detail_urlname="file_detail" filetype="all" res_type_name="" #}
        </div-->
       {% include "ndf/ggallerypage.html" %}
      </div>
      <div class="content" id="course-about">
        <div class="row collapse">
          <div class="about-course-heading">
            <div class="heading-text">
              <div>
                <h2>{{node.name}}</h2>
              </div>
              <div>Next Session Jan 5 2016 &#8226; 3:00pm</div>
              <div>
                <span><i class="fi-list-thumbnails"></i>&nbsp;10</span>
                &#8226;&nbsp;&nbsp;
                <span><i class="fi-torso"></i>&nbsp;{{group_object.author_set|length}}</span>
                &#8226;&nbsp;&nbsp;
                <span><i class="fi-clock"></i>&nbsp;6 weeks</span>
              </div>
            </div>
          </div>
        </div>
        <div class="row collapse">
          <div class="about-course-details">
            <!--@anotation('replace this with the about course details')-->
            <p>{{group_object.content_org}}
            </p>
          </div>
        </div>
      </div>
    </div>
    <!-- Each tab pages ends here -->
  </div>
</div>

{% endblock %}



{% block script %}

$(document).on('click','.enroll-btn',function(){
//trigger the ajax call to enroll
$.ajax({
url: "{% url 'enroll_to_course' node.pk %}",

data: {
'csrfmiddlewaretoken': "{{csrf_token}}"
},

type: "POST",

dataType: "json",

success: function(data){
success_state = data["success"]
if(success_state){
$(".enroll-btn").attr('value', 'ENROLLED')
$(".enroll-btn").attr("disabled","disabled")
location.reload();
}
},
});//end of ajax
})
{% endblock %}
